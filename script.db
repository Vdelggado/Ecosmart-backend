CREATE DATABASE IF NOT EXISTS ecosmart;
USE ecosmart;
 
CREATE TABLE users (
  user_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(20) NOT NULL,
  lastname VARCHAR(30) NOT NULL,
  password VARCHAR(255) UNIQUE NOT NULL,
  email VARCHAR(30) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
 CREATE TABLE category (
    category_id BIGINT PRIMARY KEY AUTO_INCREMENT,     
    name VARCHAR(100) NOT NULL,            
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, 
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP 
);
CREATE TABLE materials (
  material_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  image TEXT,
  name VARCHAR(30) NOT NULL,
  description VARCHAR(90) NOT NULL,
  category_id BIGINT NOT NULL,
  user_id BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (category_id) REFERENCES category(category_id)
);
 
CREATE TABLE recycling_center (
  center_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  name VARCHAR(40) NOT NULL,
  location VARCHAR(255) UNIQUE NOT NULL,
  phone VARCHAR(30) UNIQUE NOT NULL, 
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
 
 CREATE TABLE orders (
    order_id BIGINT AUTO_INCREMENT PRIMARY KEY,   -- Identificador único de la orden
    user_id BIGINT NOT NULL,                      -- Relación con el usuario que hizo la orden
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP, -- Fecha y hora en que se creó la orden
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, -- Última actualización
    FOREIGN KEY (user_id) REFERENCES users(user_id)-- Llave foránea hacia la tabla users
);
 
CREATE TABLE order_items (
  order_items_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  user_id BIGINT NOT NULL,
  material_id BIGINT NOT NULL,
  center_id BIGINT NOT NULL,
  order_id BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(user_id),
  FOREIGN KEY (material_id) REFERENCES materials(material_id),
  FOREIGN KEY (center_id) REFERENCES recycling_center(center_id),
  FOREIGN KEY (order_id) REFERENCES orders(order_id) ON DELETE CASCADE
);
 
CREATE TABLE rewards (
  reward_id BIGINT PRIMARY KEY AUTO_INCREMENT,
  points BIGINT NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
